http:
  routers:
    # Explorer frontend
    explorer-web:
      rule: "Host(`explorer.pokt.ai`)"
      service: explorer-web
      entryPoints:
        - websecure
      tls:
        certResolver: https-resolver
      priority: 100

    # Explorer API (if needed)
    explorer-api:
      rule: "Host(`explorer.pokt.ai`) && PathPrefix(`/api`)"
      service: explorer-web
      entryPoints:
        - websecure
      tls:
        certResolver: https-resolver
      priority: 200

    # Allow ACME challenge via HTTP FIRST (highest priority, no redirect)
    # Traefik handles ACME challenges automatically when HTTP challenge is configured
    # This route ensures the path is accessible - Traefik will intercept ACME requests
    explorer-acme-challenge:
      rule: "Host(`explorer.pokt.ai`) && PathPrefix(`/.well-known/acme-challenge/`)"
      service: explorer-web-redirect  # Dummy service - Traefik handles ACME internally
      entryPoints:
        - web
      # No redirect middleware - let Traefik handle ACME challenge natively
      priority: 1000  # Highest priority to ensure it matches before catch-all
    
    # HTTP to HTTPS redirect for explorer (exclude ACME challenge)
    explorer-web-redirect:
      rule: "Host(`explorer.pokt.ai`) && !PathPrefix(`/.well-known/acme-challenge/`)"
      service: explorer-web-redirect
      entryPoints:
        - web
      middlewares:
        - redirect-to-https
      priority: 100

  middlewares:
    # Redirect HTTP to HTTPS
    redirect-to-https:
      redirectScheme:
        scheme: https
        permanent: true

  services:
    # Explorer service (running on host port 3005)
    explorer-web:
      loadBalancer:
        servers:
          - url: "http://127.0.0.1:3005"
        healthCheck:
          path: "/"
          interval: "30s"
          timeout: "5s"

    # Redirect service (dummy)
    explorer-web-redirect:
      loadBalancer:
        servers:
          - url: "http://127.0.0.1:8080"

